#Elasticsearch概览


## Elasticsearch是什么？

Elasticsearch是一个基于Apache Lucene(TM)的开源搜索引擎。它的目的是通过简单的`RESTful API`来隐藏Lucene的复杂性，从而让全文检索变得简单。

不过，Elasticsearch不仅仅是Lucene和全文搜索，我们还能这样去描述它：

+ 分布式的实时文件存储，每个字段都被索引并可被搜索
+ 分布式实时分析搜索引擎
+ 可以扩展到上百台服务器，处理PB级结构化或非结构化数据

## Elasticsearch数据架构概念

###1.索引（index）

索引（`index`）是Elasticsearch对逻辑数据的逻辑存储，所以它可以分为更小的部分。你可以把索引看做成关系型数据库的库。

然而，索引的结构是为了快速有效的全文索引准备的，特别是它不存储原始值。

Elasticsearch可以把索引存放在一台或者分散在多台服务器上，每个索引有一或多个分片（shard），每个分片可以有多个副本。

在Elasticsearch存储数据的行为就叫索引（`indexing`）。

###2.文档（document）

存储在Elasticsearch中的主要实体叫文档（`document`）。用关系型数据库来类比的话，一个文档相当于数据库表中的一行纪录。

Elasticsearch的文档中，相同字段必须有相同类型。这意味着，所有包含title字段的文档，title字段类型都必须一样，比如string。

文档由多个字段组成，每个字段可能多次出现在一个文档里，这样的字段叫多值字段（multivalued）。

###3.文档类型(type)

在Elasticsearch中，一个索引对象可以存储次很多不同用途的对象。文档的类型可以看作是关系型数据库的表，例如，一个博客应用程序可以保存文章和评论。文档类型让我们轻易地区分耽搁索引中的不同对象。

每个文档可以有不同结构，但在实际部署中，讲文档按类型区分对数据操作有很多的帮助。当然，需要记住一个限制，不同的文档类型不能为相同属性设置不同的类型。例如，在同一索引中的所有文档类型中，一个叫title的字段必须具有相同的类型。

###4.映射

映射就是文档的元数据。Elasticsearch在映射中存储有关字段的信息，每一个文档类型都有的自己映射，即使我们没有明确定义。

映射（mapping）机制用于进行字段类型确认，将每个字段匹配为一种确定的数据类型（string，number，booleans，date等）。

## Elasticsearch主要概念

Elasticsearch把数据存储在一个或多个索引上，每个索引包含各种类型的文档。每个文档有很多字段，映射定义了Elasticsearch如何对待这些字段。从一开始，Elasticsearch就被设计为能处理数以亿计的文档和每秒数以百计的搜索请求的分布式解决方案。

### 1.节点和集群

Elasticsearch可以作为一个独立的单个搜索服务器。不过，为了能够处理大型数据集，实现容错和高可用，Elasticsrach可以运行在许多互相合作的服务器上，这些服务器称为集群（`cluster`），形成集群的每个服务器称为节点（`node`）。

### 2.分片

当有大量的文档时，由于内存限制、硬盘能力、处理能力不足、无法足够快地响应客户端请求等，一个节点可能不够。在这种情况下，数据可以分为较小的分片（每个分片都是一个独立的Lucene索引）。

每个分片可以放在不同的服务器上，因此，数据可以在集群的节点中传播。当你查询的索引分布在多个分片上时，Elasticsearch会把查询发送给每个相关的分片，并将结果合并在一起，而应用程序并不知道分片的存在。

***＊多个分片可以加快索引。***

### 3.副本

为了提高吞吐量或实现高可用，可以使用分片副本。副本（`replica`）只是一片的精确复制，每个分片可以有零个或多个副本。

换句话说，Elasticsearch可以有许多相同的分片，其中之一被自动选择去更改索引操作。这种特殊的分片成为主分片（`primary shard`），其余称为副本分片(`replica shard`)。在主分片丢失时，例如该分片数据所在服务器不可用，集群将副本提升为新主分片。

### 4.时光之门

Elasticsearch处理许多节点。集群的状态由时光之门控制。默认情况下，每个节点的在本地存储这些信息，并且在节点中同步。



